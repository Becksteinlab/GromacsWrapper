

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>gromacs.cbook – Gromacs Cook Book &mdash; GromacsWrapper 0.3.1 documentation</title>
    
    <link rel="stylesheet" href="../../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '0.3.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../../_static/GromacsWrapper_logo_32x32.ico"/>
    <link rel="top" title="GromacsWrapper 0.3.1 documentation" href="../../index.html" />
    <link rel="up" title="Gromacs building blocks" href="../building_blocks.html" />
    <link rel="next" title="gromacs.setup – Setting up a Gromacs MD run" href="setup.html" />
    <link rel="prev" title="Gromacs building blocks" href="../building_blocks.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="setup.html" title="gromacs.setup – Setting up a Gromacs MD run"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../building_blocks.html" title="Gromacs building blocks"
             accesskey="P">previous</a> |</li>
        <li><a href="../../index.html">GromacsWrapper 0.3.1 documentation</a> &raquo;</li>
          <li><a href="../../gromacs.html" >Gromacs package</a> &raquo;</li>
          <li><a href="../building_blocks.html" accesskey="U">Gromacs building blocks</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/GromacsWrapper_logo_200x200.png" alt="Logo"/>
            </a></p>
  <h3><a href="../../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#"><tt class="docutils literal"><span class="pre">gromacs.cbook</span></tt> &#8211; Gromacs Cook Book</a><ul>
<li><a class="reference internal" href="#miscellaneous-canned-gromacs-commands">Miscellaneous canned Gromacs commands</a></li>
<li><a class="reference internal" href="#manipulating-trajectories-and-structures">Manipulating trajectories and structures</a></li>
<li><a class="reference internal" href="#processing-output">Processing output</a></li>
<li><a class="reference internal" href="#working-with-topologies-and-mdp-files">Working with topologies and mdp files</a></li>
<li><a class="reference internal" href="#working-with-index-files">Working with index files</a></li>
<li><a class="reference internal" href="#file-editing-functions">File editing functions</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="../building_blocks.html"
                        title="previous chapter">Gromacs building blocks</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="setup.html"
                        title="next chapter"><tt class="docutils literal"><span class="pre">gromacs.setup</span></tt> &#8211; Setting up a Gromacs MD run</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../../_sources/gromacs/blocks/cbook.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <span class="target" id="module-gromacs.cbook"></span><div class="section" id="gromacs-cbook-gromacs-cook-book">
<h1><a class="reference internal" href="#module-gromacs.cbook" title="gromacs.cbook"><tt class="xref py py-mod docutils literal"><span class="pre">gromacs.cbook</span></tt></a> &#8211; Gromacs Cook Book<a class="headerlink" href="#gromacs-cbook-gromacs-cook-book" title="Permalink to this headline">¶</a></h1>
<p>The <a class="reference internal" href="#module-gromacs.cbook" title="gromacs.cbook"><tt class="xref py py-mod docutils literal"><span class="pre">cbook</span></tt></a> (cook book) module contains short recipes for tasks
that are often repeated. In the simplest case this is just one of the
gromacs tools with a certain set of default command line options.</p>
<p>By abstracting and collecting these invocations here, errors can be
reduced and the code snippets can also serve as canonical examples for
how to do simple things.</p>
<div class="section" id="miscellaneous-canned-gromacs-commands">
<h2>Miscellaneous canned Gromacs commands<a class="headerlink" href="#miscellaneous-canned-gromacs-commands" title="Permalink to this headline">¶</a></h2>
<p>Simple commands with new default options so that they solve a specific
problem (see also <a class="reference internal" href="#manipulating-trajectories-and-structures">Manipulating trajectories and structures</a>):</p>
<dl class="function">
<dt id="gromacs.cbook.rmsd_backbone">
<tt class="descclassname">gromacs.cbook.</tt><tt class="descname">rmsd_backbone</tt><big>(</big><span class="optional">[</span><em>s=&quot;md.tpr&quot;</em>, <em>f=&quot;md.xtc&quot;</em><span class="optional">[</span>, <em>...</em><span class="optional">]</span><span class="optional">]</span><big>)</big><a class="headerlink" href="#gromacs.cbook.rmsd_backbone" title="Permalink to this definition">¶</a></dt>
<dd><p>Computes the RMSD of the &#8220;Backbone&#8221; atoms after fitting to the
&#8220;Backbone&#8221; (including both translation and rotation).</p>
</dd></dl>

</div>
<div class="section" id="manipulating-trajectories-and-structures">
<h2>Manipulating trajectories and structures<a class="headerlink" href="#manipulating-trajectories-and-structures" title="Permalink to this headline">¶</a></h2>
<p>Standard invocations for manipulating trajectories.</p>
<dl class="function">
<dt id="gromacs.cbook.trj_compact">
<tt class="descclassname">gromacs.cbook.</tt><tt class="descname">trj_compact</tt><big>(</big><span class="optional">[</span><em>s=&quot;md.tpr&quot;</em>, <em>f=&quot;md.xtc&quot;</em>, <em>o=&quot;compact.xtc&quot;</em><span class="optional">[</span>, <em>...</em><span class="optional">]</span><span class="optional">]</span><big>)</big><a class="headerlink" href="#gromacs.cbook.trj_compact" title="Permalink to this definition">¶</a></dt>
<dd><p>Writes an output trajectory or frame with a compact representation
of the system centered on the protein. It centers on the group
&#8220;Protein&#8221; and outputs the whole &#8220;System&#8221; group.</p>
</dd></dl>

<dl class="function">
<dt id="gromacs.cbook.trj_xyfitted">
<tt class="descclassname">gromacs.cbook.</tt><tt class="descname">trj_xyfitted</tt><big>(</big><span class="optional">[</span><em>s=&quot;md.tpr&quot;</em>, <em>f=&quot;md.xtc&quot;</em><span class="optional">[</span>, <em>...</em><span class="optional">]</span><span class="optional">]</span><big>)</big><a class="headerlink" href="#gromacs.cbook.trj_xyfitted" title="Permalink to this definition">¶</a></dt>
<dd><p>Writes a trajectory centered and fitted to the protein in the XY-plane only.</p>
<p>This is useful for membrane proteins. The system <em>must</em> be oriented so that
the membrane is in the XY plane. The protein backbone is used for the least
square fit, centering is done for the whole protein., but this can be
changed with the <em>input</em> = <tt class="docutils literal"><span class="pre">('backbone',</span> <span class="pre">'protein','system')</span></tt> keyword.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Gromacs 4.x only</p>
</div>
</dd></dl>

<dl class="function">
<dt id="gromacs.cbook.trj_fitandcenter">
<tt class="descclassname">gromacs.cbook.</tt><tt class="descname">trj_fitandcenter</tt><big>(</big><em>xy=False</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#gromacs.cbook.trj_fitandcenter" title="Permalink to this definition">¶</a></dt>
<dd><p>Center everything and make a compact representation (pass 1) and fit the system to a reference (pass 2).</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Keywords :</th><td class="field-body"><dl class="first last docutils">
<dt><em>s</em></dt>
<dd><p class="first">input structure file (tpr file required to make molecule whole);
if a list or tuple is provided then s[0] is used for pass 1 (should be a tpr)
and s[1] is used for the fitting step (can be a pdb of the whole system)</p>
<p class="last">If a second structure is supplied then it is assumed that the fitted
trajectory should <em>not</em> be centered.</p>
</dd>
<dt><em>f</em></dt>
<dd><p class="first last">input trajectory</p>
</dd>
<dt><em>o</em></dt>
<dd><p class="first last">output trajectory</p>
</dd>
<dt><em>input</em></dt>
<dd><dl class="first docutils">
<dt>A list with three groups. The default is</dt>
<dd><p class="first last">[&#8216;backbone&#8217;, &#8216;protein&#8217;,&#8217;system&#8217;]</p>
</dd>
</dl>
<p class="last">The fit command uses all three (1st for least square fit,
2nd for centering, 3rd for output), the centered/make-whole stage use
2nd for centering and 3rd for output.</p>
</dd>
<dt><em>input1</em></dt>
<dd><p class="first last">If <em>input1</em> is supplied then <em>input</em> is used exclusively
for the fitting stage (pass 2) and <em>input1</em> for the centering (pass 1).</p>
</dd>
<dt><em>n</em></dt>
<dd><p class="first last">Index file used for pass 1 and pass 2.</p>
</dd>
<dt><em>n1</em></dt>
<dd><p class="first last">If <em>n1</em> is supplied then index <em>n1</em> is only used for pass 1
(centering) and <em>n</em> for pass 2 (fitting).</p>
</dd>
<dt><em>xy</em> <span class="classifier-delimiter">:</span> <span class="classifier">boolean</span></dt>
<dd><p class="first last">If <tt class="docutils literal"><span class="pre">True</span></tt> then only do a rot+trans fit in the xy plane
(good for membrane simulations); default is <tt class="docutils literal"><span class="pre">False</span></tt>.</p>
</dd>
<dt><em>kwargs</em></dt>
<dd><p class="first last">All other arguments are passed to <tt class="xref py py-class docutils literal"><span class="pre">Trjconv</span></tt>.</p>
</dd>
</dl>
</td>
</tr>
</tbody>
</table>
<p>Note that here we first center the protein and create a compact box, using
<tt class="docutils literal"><span class="pre">-pbc</span> <span class="pre">mol</span> <span class="pre">-ur</span> <span class="pre">compact</span> <span class="pre">-center</span> <span class="pre">-boxcenter</span> <span class="pre">tric</span></tt> and write an intermediate
xtc. Then in a second pass we perform a rotation+translation fit (or
restricted to the xy plane if <em>xy</em> = <tt class="docutils literal"><span class="pre">True</span></tt> is set) on the intermediate
xtc to produce the final trajectory. Doing it in this order has the
disadvantage that the solvent box is rotating around the protein but the
opposite order (with center/compact second) produces strange artifacts
where columns of solvent appear cut out from the box&#8212;it probably means
that after rotation the information for the periodic boundaries is not
correct any more.</p>
<p>Most kwargs are passed to both invocations of
<tt class="xref py py-class docutils literal"><span class="pre">gromacs.tools.Trjconv</span></tt> so it does not really make sense to use eg
<em>skip</em>; in this case do things manually.</p>
<p>By default the <em>input</em> to the fit command is (&#8216;backbone&#8217;,
&#8216;protein&#8217;,&#8217;system&#8217;); the compact command always uses the second and third
group for its purposes or if this fails, prompts the user.</p>
<p>Both steps cannot performed in one pass; this is a known limitation of
<tt class="docutils literal"><span class="pre">trjconv</span></tt>. An intermediate temporary XTC files is generated which should
be automatically cleaned up unless bad things happened.</p>
<p>The function tries to honour the input/output formats. For instance, if you
want trr output you need to supply a trr file as input and explicitly give
the output file also a trr suffix.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">For big trajectories it can <strong>take a very long time</strong>
and consume a <strong>large amount of temporary diskspace</strong>.</p>
</div>
<p>We follow the <a class="reference external" href="http://www.gromacs.org/Documentation/Gromacs_Utilities/g_spatial">g_spatial documentation</a> in preparing the trajectories:</p>
<div class="highlight-python"><pre>trjconv -s a.tpr -f a.xtc -o b.xtc -center -boxcenter tric -ur compact -pbc mol
trjconv -s a.tpr -f b.xtc -o c.xtc -fit rot+trans</pre>
</div>
</dd></dl>

<dl class="function">
<dt id="gromacs.cbook.cat">
<tt class="descclassname">gromacs.cbook.</tt><tt class="descname">cat</tt><big>(</big><em>prefix='md'</em>, <em>dirname='.'</em>, <em>partsdir='parts'</em>, <em>fulldir='full'</em>, <em>resolve_multi='pass'</em><big>)</big><a class="headerlink" href="#gromacs.cbook.cat" title="Permalink to this definition">¶</a></dt>
<dd><p>Concatenate all parts of a simulation.</p>
<p>The xtc, trr, and edr files in <em>dirname</em> such as prefix.xtc,
prefix.part0002.xtc, prefix.part0003.xtc, ... are</p>
<blockquote>
<div><ol class="arabic simple">
<li>moved to the <em>partsdir</em> (under <em>dirname</em>)</li>
<li>concatenated with the Gromacs tools to yield prefix.xtc, prefix.trr,
prefix.edr, prefix.gro (or prefix.md) in <em>dirname</em></li>
<li>Store these trajectories in <em>fulldir</em></li>
</ol>
</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Trajectory files are <em>never</em> deleted by this function to avoid
data loss in case of bugs. You will have to clean up yourself
by deleting <em>dirname</em>/<em>partsdir</em>.</p>
<p class="last">Symlinks for the trajectories are <em>not</em> handled well and
break the function. Use hard links instead.</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">If an exception occurs when running this function then make
doubly and triply sure where your files are before running
this function again; otherwise you might <strong>overwrite data</strong>.
Possibly you will need to manually move the files from <em>partsdir</em>
back into the working directory <em>dirname</em>; this should onlu overwrite
generated files so far but <em>check carefully</em>!</p>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Keywords :</th><td class="field-body"><dl class="first last docutils">
<dt><em>prefix</em></dt>
<dd><p class="first last">deffnm of the trajectories [md]</p>
</dd>
<dt><a href="#id1"><span class="problematic" id="id2">*</span></a>resolve_multi&#8221;</dt>
<dd><p class="first">how to deal with multiple &#8220;final&#8221; gro or pdb files: normally there should
only be one but in case of restarting from the checkpoint of a finished
simulation one can end up with multiple identical ones.</p>
<blockquote class="last">
<div><ul>
<li><p class="first">&#8220;pass&#8221; : do nothing and log a warning</p>
</li>
<li><dl class="first docutils">
<dt>&#8220;guess&#8221; <span class="classifier-delimiter">:</span> <span class="classifier">take prefix.pdb or prefix.gro if it exists, otherwise the one of</span></dt>
<dd><p class="first last">prefix.partNNNN.gro|pdb with the highes NNNN</p>
</dd>
</dl>
</li>
</ul>
</div></blockquote>
</dd>
<dt><em>dirname</em></dt>
<dd><p class="first last">change to <em>dirname</em> and assume all tarjectories are located there [.]</p>
</dd>
<dt><em>partsdir</em></dt>
<dd><p class="first last">directory where to store the input files (they are moved out of the way);
<em>partsdir</em> must be manually deleted [parts]</p>
</dd>
<dt><em>fulldir</em></dt>
<dd><p class="first last">directory where to store the final results [full]</p>
</dd>
</dl>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="class">
<dt id="gromacs.cbook.Frames">
<em class="property">class </em><tt class="descclassname">gromacs.cbook.</tt><tt class="descname">Frames</tt><big>(</big><em>structure</em>, <em>trj</em>, <em>maxframes=None</em>, <em>format='pdb'</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#gromacs.cbook.Frames" title="Permalink to this definition">¶</a></dt>
<dd><p>A iterator that transparently provides frames from a trajectory.</p>
<p>The iterator chops a trajectory into individual frames for
analysis tools that only work on separate structures such as
<tt class="docutils literal"><span class="pre">gro</span></tt> or <tt class="docutils literal"><span class="pre">pdb</span></tt> files. Instead of turning the whole trajectory
immediately into pdb files (and potentially filling the disk), the
iterator can be instructed to only provide a fixed number of
frames and compute more frames when needed.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Setting a limit on the number of frames on disk can lead
to longish waiting times because <tt class="docutils literal"><span class="pre">trjconv</span></tt> must
re-seek to the middle of the trajectory and the only way
it can do this at the moment is by reading frames
sequentially. This might still be preferrable to filling
up a disk, though.</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">The <em>maxframes</em> option is not implemented yet; use
the <em>dt</em> option or similar to keep the number of frames
manageable.</p>
</div>
<p>Set up the Frames iterator.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments :</th><td class="field-body"><dl class="first last docutils">
<dt>structure</dt>
<dd><p class="first last">name of a structure file (tpr, pdb, ...)</p>
</dd>
<dt>trj</dt>
<dd><p class="first last">name of the trajectory (xtc, trr, ...)</p>
</dd>
<dt>format</dt>
<dd><p class="first last">output format for the frames, eg &#8220;pdb&#8221; or &#8220;gro&#8221; [pdb]</p>
</dd>
<dt>maxframes <span class="classifier-delimiter">:</span> <span class="classifier">int</span></dt>
<dd><p class="first last">maximum number of frames that are extracted to disk at
one time; set to <tt class="docutils literal"><span class="pre">None</span></tt> to extract the whole trajectory
at once. [<tt class="docutils literal"><span class="pre">None</span></tt>]</p>
</dd>
<dt>kwargs</dt>
<dd><p class="first last">All other arguments are passed to
<cite>class:~gromacs.tools.Trjconv</cite>; the only options that
cannot be changed are <em>sep</em> and the output file name <em>o</em>.</p>
</dd>
</dl>
</td>
</tr>
</tbody>
</table>
<dl class="attribute">
<dt id="gromacs.cbook.Frames.all_frames">
<tt class="descname">all_frames</tt><a class="headerlink" href="#gromacs.cbook.Frames.all_frames" title="Permalink to this definition">¶</a></dt>
<dd><p>Unordered list of all frames currently held on disk.</p>
</dd></dl>

<dl class="method">
<dt id="gromacs.cbook.Frames.cleanup">
<tt class="descname">cleanup</tt><big>(</big><big>)</big><a class="headerlink" href="#gromacs.cbook.Frames.cleanup" title="Permalink to this definition">¶</a></dt>
<dd><p>Clean up all temporary frames (which can be HUGE).</p>
</dd></dl>

<dl class="method">
<dt id="gromacs.cbook.Frames.delete_frames">
<tt class="descname">delete_frames</tt><big>(</big><big>)</big><a class="headerlink" href="#gromacs.cbook.Frames.delete_frames" title="Permalink to this definition">¶</a></dt>
<dd><p>Delete all frames.</p>
</dd></dl>

<dl class="method">
<dt id="gromacs.cbook.Frames.extract">
<tt class="descname">extract</tt><big>(</big><big>)</big><a class="headerlink" href="#gromacs.cbook.Frames.extract" title="Permalink to this definition">¶</a></dt>
<dd><p>Extract frames from the trajectory to the temporary directory.</p>
</dd></dl>

<dl class="attribute">
<dt id="gromacs.cbook.Frames.framenumber">
<tt class="descname">framenumber</tt><em class="property"> = None</em><a class="headerlink" href="#gromacs.cbook.Frames.framenumber" title="Permalink to this definition">¶</a></dt>
<dd><p>Holds the current frame number of the currently extracted
batch of frames. Increases when iterating.</p>
</dd></dl>

<dl class="attribute">
<dt id="gromacs.cbook.Frames.totalframes">
<tt class="descname">totalframes</tt><em class="property"> = None</em><a class="headerlink" href="#gromacs.cbook.Frames.totalframes" title="Permalink to this definition">¶</a></dt>
<dd><p>Total number of frames read so far; only important when <em>maxframes</em> &gt; 0 is used.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="gromacs.cbook.Transformer">
<em class="property">class </em><tt class="descclassname">gromacs.cbook.</tt><tt class="descname">Transformer</tt><big>(</big><em>s='topol.tpr'</em>, <em>f='traj.xtc'</em>, <em>n=None</em>, <em>force=None</em>, <em>dirname='.'</em><big>)</big><a class="headerlink" href="#gromacs.cbook.Transformer" title="Permalink to this definition">¶</a></dt>
<dd><p>Class to handle transformations of trajectories.</p>
<ol class="arabic simple">
<li>Center, compact, and fit to reference structure in tpr
(optionally, only center in the xy plane): <a class="reference internal" href="#gromacs.cbook.Transformer.center_fit" title="gromacs.cbook.Transformer.center_fit"><tt class="xref py py-meth docutils literal"><span class="pre">center_fit()</span></tt></a></li>
<li>Write compact xtc and tpr with water removed: <a class="reference internal" href="#gromacs.cbook.Transformer.strip_water" title="gromacs.cbook.Transformer.strip_water"><tt class="xref py py-meth docutils literal"><span class="pre">strip_water()</span></tt></a></li>
<li>Write compact xtc and tpr only with protein: <a class="reference internal" href="#gromacs.cbook.Transformer.keep_protein_only" title="gromacs.cbook.Transformer.keep_protein_only"><tt class="xref py py-meth docutils literal"><span class="pre">keep_protein_only()</span></tt></a></li>
</ol>
<p>Set up Transformer with structure and trajectory.</p>
<p>Supply <em>n</em> = tpr, <em>f</em> = xtc (and <em>n</em> = ndx) relative to dirname.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Keywords :</th><td class="field-body"><dl class="first last docutils">
<dt><em>s</em></dt>
<dd><p class="first last">tpr file (or similar); note that this should not contain
position restraints if it is to be used with a reduced
system (see <a class="reference internal" href="#gromacs.cbook.Transformer.strip_water" title="gromacs.cbook.Transformer.strip_water"><tt class="xref py py-meth docutils literal"><span class="pre">strip_water()</span></tt></a>)</p>
</dd>
<dt><em>f</em></dt>
<dd><p class="first last">trajectory (xtc, trr, ...)</p>
</dd>
<dt><em>n</em></dt>
<dd><p class="first last">index file (it is typically safe to leave this as <tt class="docutils literal"><span class="pre">None</span></tt>; in
cases where a trajectory needs to be centered on non-standard
groups this should contain those groups)</p>
</dd>
<dt><em>force</em></dt>
<dd><dl class="first last docutils">
<dt>Set the default behaviour for handling existing files:</dt>
<dd><ul class="first last simple">
<li><tt class="docutils literal"><span class="pre">True</span></tt>: overwrite existing trajectories</li>
<li><tt class="docutils literal"><span class="pre">False</span></tt>: throw a IOError exception</li>
<li><tt class="docutils literal"><span class="pre">None</span></tt>: skip existing and log a warning [default]</li>
</ul>
</dd>
</dl>
</dd>
</dl>
</td>
</tr>
</tbody>
</table>
<dl class="method">
<dt id="gromacs.cbook.Transformer.center_fit">
<tt class="descname">center_fit</tt><big>(</big><em>**kwargs</em><big>)</big><a class="headerlink" href="#gromacs.cbook.Transformer.center_fit" title="Permalink to this definition">¶</a></dt>
<dd><p>Write compact xtc that is fitted to the tpr reference structure.</p>
<p>See <a class="reference internal" href="#gromacs.cbook.trj_fitandcenter" title="gromacs.cbook.trj_fitandcenter"><tt class="xref py py-func docutils literal"><span class="pre">gromacs.cbook.trj_fitandcenter()</span></tt></a> for details and
description of <em>kwargs</em>. The most important ones are listed
here but in most cases the defaults should work.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Keywords :</th><td class="field-body"><dl class="first docutils">
<dt><em>s</em></dt>
<dd><p class="first last">Input structure (typically the default tpr file but can be set to
some other file with a different conformation for fitting)</p>
</dd>
<dt><em>n</em></dt>
<dd><p class="first last">Alternative index file.</p>
</dd>
<dt><em>o</em></dt>
<dd><p class="first last">Name of the output trajectory.</p>
</dd>
<dt><em>xy</em> <span class="classifier-delimiter">:</span> <span class="classifier">Boolean</span></dt>
<dd><p class="first last">If <tt class="docutils literal"><span class="pre">True</span></tt> then only fit in xy-plane (useful for a membrane normal
to z). The default is <tt class="docutils literal"><span class="pre">False</span></tt>.</p>
</dd>
<dt><em>force</em></dt>
<dd><ul class="first last simple">
<li><tt class="docutils literal"><span class="pre">True</span></tt>: overwrite existing trajectories</li>
<li><tt class="docutils literal"><span class="pre">False</span></tt>: throw a IOError exception</li>
<li><tt class="docutils literal"><span class="pre">None</span></tt>: skip existing and log a warning [default]</li>
</ul>
</dd>
</dl>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns :</th><td class="field-body"><p class="first last">dictionary with keys <em>tpr</em>, <em>xtc</em>, which are the names of the
the new files</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="gromacs.cbook.Transformer.fit">
<tt class="descname">fit</tt><big>(</big><em>xy=False</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#gromacs.cbook.Transformer.fit" title="Permalink to this definition">¶</a></dt>
<dd><p>Write xtc that is fitted to the tpr reference structure.</p>
<p>See <a class="reference internal" href="#gromacs.cbook.trj_xyfitted" title="gromacs.cbook.trj_xyfitted"><tt class="xref py py-func docutils literal"><span class="pre">gromacs.cbook.trj_xyfitted()</span></tt></a> for details and
description of <em>kwargs</em>. The most important ones are listed
here but in most cases the defaults should work.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Keywords :</th><td class="field-body"><blockquote class="first">
<div><dl class="docutils">
<dt><em>s</em></dt>
<dd><p class="first last">Input structure (typically the default tpr file but can be set to
some other file with a different conformation for fitting)</p>
</dd>
<dt><em>n</em></dt>
<dd><p class="first last">Alternative index file.</p>
</dd>
<dt><em>o</em></dt>
<dd><p class="first last">Name of the output trajectory. A default name is created.
If e.g. <em>dt</em> = 100  is one of the <em>kwargs</em> then the default name includes
&#8220;_dt100ps&#8221;.</p>
</dd>
</dl>
</div></blockquote>
<dl class="docutils">
<dt><em>xy</em> <span class="classifier-delimiter">:</span> <span class="classifier">boolean</span></dt>
<dd><p class="first last">If <tt class="docutils literal"><span class="pre">True</span></tt> then only do a rot+trans fit in the xy plane
(good for membrane simulations); default is <tt class="docutils literal"><span class="pre">False</span></tt>.</p>
</dd>
<dt><em>force</em></dt>
<dd><p class="first last"><tt class="docutils literal"><span class="pre">True</span></tt>: overwrite existing trajectories
<tt class="docutils literal"><span class="pre">False</span></tt>: throw a IOError exception
<tt class="docutils literal"><span class="pre">None</span></tt>: skip existing and log a warning [default]</p>
</dd>
<dt><em>kwargs</em></dt>
<dd><p class="first last">kwargs are passed to <a class="reference internal" href="#gromacs.cbook.trj_xyfitted" title="gromacs.cbook.trj_xyfitted"><tt class="xref py py-func docutils literal"><span class="pre">trj_xyfitted()</span></tt></a></p>
</dd>
</dl>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns :</th><td class="field-body"><p class="first last">dictionary with keys <em>tpr</em>, <em>xtc</em>, which are the names of the
the new files</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="gromacs.cbook.Transformer.keep_protein_only">
<tt class="descname">keep_protein_only</tt><big>(</big><em>os=None</em>, <em>o=None</em>, <em>on=None</em>, <em>compact=False</em>, <em>groupname='proteinonly'</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#gromacs.cbook.Transformer.keep_protein_only" title="Permalink to this definition">¶</a></dt>
<dd><p>Write xtc and tpr only containing the protein.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Keywords :</th><td class="field-body"><dl class="first docutils">
<dt><em>os</em></dt>
<dd><p class="first last">Name of the output tpr file; by default use the original but
insert &#8220;proteinonly&#8221; before suffix.</p>
</dd>
<dt><em>o</em></dt>
<dd><p class="first last">Name of the output trajectory; by default use the original name but
insert &#8220;proteinonly&#8221; before suffix.</p>
</dd>
<dt><em>on</em></dt>
<dd><p class="first last">Name of a new index file.</p>
</dd>
<dt><em>compact</em></dt>
<dd><p class="first last"><tt class="docutils literal"><span class="pre">True</span></tt>: write a compact and centered trajectory
<tt class="docutils literal"><span class="pre">False</span></tt>: use trajectory as it is [<tt class="docutils literal"><span class="pre">False</span></tt>]</p>
</dd>
<dt><em>groupname</em></dt>
<dd><p class="first last">Name of the protein-only group.</p>
</dd>
<dt><em>keepalso</em></dt>
<dd><p class="first last">List of literal make_ndx selections of additional groups that should
be kept, e.g. [&#8216;resname DRUG&#8217;, &#8216;atom 6789&#8217;].</p>
</dd>
<dt><em>force</em> <span class="classifier-delimiter">:</span> <span class="classifier">Boolean</span></dt>
<dd><ul class="first last simple">
<li><tt class="docutils literal"><span class="pre">True</span></tt>: overwrite existing trajectories</li>
<li><tt class="docutils literal"><span class="pre">False</span></tt>: throw a IOError exception</li>
<li><tt class="docutils literal"><span class="pre">None</span></tt>: skip existing and log a warning [default]</li>
</ul>
</dd>
<dt><em>kwargs</em></dt>
<dd><p class="first last">are passed on to <a class="reference internal" href="#gromacs.cbook.trj_compact" title="gromacs.cbook.trj_compact"><tt class="xref py py-func docutils literal"><span class="pre">gromacs.cbook.trj_compact()</span></tt></a> (unless the
values have to be set to certain values such as s, f, n, o
keywords). The <em>input</em> keyword is always mangled: Only the first
entry (the group to centre the trajectory on) is kept, and as a
second group (the output group) <em>groupname</em> is used.</p>
</dd>
</dl>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns :</th><td class="field-body"><p class="first last">dictionary with keys <em>tpr</em>, <em>xtc</em>, <em>ndx</em> which are the names of the
the new files</p>
</td>
</tr>
</tbody>
</table>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>The input tpr file should <em>not</em> have <em>any position restraints</em>;
otherwise Gromacs will throw a hissy-fit and say</p>
<p><em>Software inconsistency error: Position restraint coordinates are
missing</em></p>
<p class="last">(This appears to be a bug in Gromacs 4.x.)</p>
</div>
</dd></dl>

<dl class="method">
<dt id="gromacs.cbook.Transformer.rp">
<tt class="descname">rp</tt><big>(</big><em>*args</em><big>)</big><a class="headerlink" href="#gromacs.cbook.Transformer.rp" title="Permalink to this definition">¶</a></dt>
<dd><p>Return canonical path to file under <em>dirname</em> with components <em>args</em></p>
<p>If <em>args</em> form an absolute path then just return it as the absolute path.</p>
</dd></dl>

<dl class="method">
<dt id="gromacs.cbook.Transformer.strip_fit">
<tt class="descname">strip_fit</tt><big>(</big><em>**kwargs</em><big>)</big><a class="headerlink" href="#gromacs.cbook.Transformer.strip_fit" title="Permalink to this definition">¶</a></dt>
<dd><p>Strip water and fit to the remaining system.</p>
<p>First runs <a class="reference internal" href="#gromacs.cbook.Transformer.strip_water" title="gromacs.cbook.Transformer.strip_water"><tt class="xref py py-meth docutils literal"><span class="pre">strip_water()</span></tt></a> and then <a class="reference internal" href="#gromacs.cbook.Transformer.fit" title="gromacs.cbook.Transformer.fit"><tt class="xref py py-meth docutils literal"><span class="pre">fit()</span></tt></a>; see there
for arguments.</p>
<ul class="simple">
<li><em>strip_input</em> is used for <a class="reference internal" href="#gromacs.cbook.Transformer.strip_water" title="gromacs.cbook.Transformer.strip_water"><tt class="xref py py-meth docutils literal"><span class="pre">strip_water()</span></tt></a> (but is only useful in
special cases, e.g. when there is no Protein group defined. Then set
<em>strip_input</em> = <tt class="docutils literal"><span class="pre">['Other']</span></tt>.</li>
<li><em>input</em> is passed on to <a class="reference internal" href="#gromacs.cbook.Transformer.fit" title="gromacs.cbook.Transformer.fit"><tt class="xref py py-meth docutils literal"><span class="pre">fit()</span></tt></a> and can contain the
[center_group, fit_group, output_group]</li>
<li>By default <em>fit</em> = &#8220;rot+trans&#8221; (and <em>fit</em> is passed to <a class="reference internal" href="#gromacs.cbook.Transformer.fit" title="gromacs.cbook.Transformer.fit"><tt class="xref py py-meth docutils literal"><span class="pre">fit()</span></tt></a>,
together with the <em>xy</em> = <tt class="docutils literal"><span class="pre">False</span></tt> keyword)</li>
</ul>
</dd></dl>

<dl class="method">
<dt id="gromacs.cbook.Transformer.strip_water">
<tt class="descname">strip_water</tt><big>(</big><em>os=None</em>, <em>o=None</em>, <em>on=None</em>, <em>compact=False</em>, <em>resn='SOL'</em>, <em>groupname='notwater'</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#gromacs.cbook.Transformer.strip_water" title="Permalink to this definition">¶</a></dt>
<dd><p>Write xtc and tpr with water (by resname) removed.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Keywords :</th><td class="field-body"><dl class="first docutils">
<dt><em>os</em></dt>
<dd><p class="first last">Name of the output tpr file; by default use the original but
insert &#8220;nowater&#8221; before suffix.</p>
</dd>
<dt><em>o</em></dt>
<dd><p class="first last">Name of the output trajectory; by default use the original name but
insert &#8220;nowater&#8221; before suffix.</p>
</dd>
<dt><em>on</em></dt>
<dd><p class="first last">Name of a new index file (without water).</p>
</dd>
<dt><em>compact</em></dt>
<dd><p class="first last"><tt class="docutils literal"><span class="pre">True</span></tt>: write a compact and centered trajectory
<tt class="docutils literal"><span class="pre">False</span></tt>: use trajectory as it is [<tt class="docutils literal"><span class="pre">False</span></tt>]</p>
</dd>
<dt><em>resn</em></dt>
<dd><p class="first last">Residue name of the water molecules; all these residues are excluded.</p>
</dd>
<dt><em>groupname</em></dt>
<dd><p class="first last">Name of the group that is generated by subtracting all waters
from the system.</p>
</dd>
<dt><em>force</em> <span class="classifier-delimiter">:</span> <span class="classifier">Boolean</span></dt>
<dd><ul class="first last simple">
<li><tt class="docutils literal"><span class="pre">True</span></tt>: overwrite existing trajectories</li>
<li><tt class="docutils literal"><span class="pre">False</span></tt>: throw a IOError exception</li>
<li><tt class="docutils literal"><span class="pre">None</span></tt>: skip existing and log a warning [default]</li>
</ul>
</dd>
<dt><em>kwargs</em></dt>
<dd><p class="first last">are passed on to <a class="reference internal" href="#gromacs.cbook.trj_compact" title="gromacs.cbook.trj_compact"><tt class="xref py py-func docutils literal"><span class="pre">gromacs.cbook.trj_compact()</span></tt></a> (unless the
values have to be set to certain values such as s, f, n, o
keywords). The <em>input</em> keyword is always mangled: Only the first
entry (the group to centre the trajectory on) is kept, and as a
second group (the output group) <em>groupname</em> is used.</p>
</dd>
</dl>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns :</th><td class="field-body"><p class="first last">dictionary with keys <em>tpr</em>, <em>xtc</em>, <em>ndx</em> which are the names of the
the new files</p>
</td>
</tr>
</tbody>
</table>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>The input tpr file should <em>not</em> have <em>any position restraints</em>;
otherwise Gromacs will throw a hissy-fit and say</p>
<p><em>Software inconsistency error: Position restraint coordinates are
missing</em></p>
<p class="last">(This appears to be a bug in Gromacs 4.x.)</p>
</div>
</dd></dl>

</dd></dl>

<dl class="function">
<dt id="gromacs.cbook.get_volume">
<tt class="descclassname">gromacs.cbook.</tt><tt class="descname">get_volume</tt><big>(</big><em>f</em><big>)</big><a class="headerlink" href="#gromacs.cbook.get_volume" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the volume in nm^3 of structure file <em>f</em>.</p>
<p>(Uses <tt class="xref py py-func docutils literal"><span class="pre">gromacs.editconf()</span></tt>; error handling is not good)</p>
</dd></dl>

</div>
<div class="section" id="processing-output">
<h2>Processing output<a class="headerlink" href="#processing-output" title="Permalink to this headline">¶</a></h2>
<p>There are cases when a script has to to do different things depending
on the output from a Gromacs tool.</p>
<p>For instance, a common case is to check the total charge after
grompping a tpr file. The <tt class="docutils literal"><span class="pre">grompp_qtot</span></tt> function does just that.</p>
<dl class="function">
<dt id="gromacs.cbook.grompp_qtot">
<tt class="descclassname">gromacs.cbook.</tt><tt class="descname">grompp_qtot</tt><big>(</big><em>*args</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#gromacs.cbook.grompp_qtot" title="Permalink to this definition">¶</a></dt>
<dd><p>Run <tt class="docutils literal"><span class="pre">gromacs.grompp</span></tt> and return the total charge of the  system.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments :</th><td class="field-body">The arguments are the ones one would pass to <tt class="xref py py-func docutils literal"><span class="pre">gromacs.grompp()</span></tt>.</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns :</th><td class="field-body">The total charge as reported</td>
</tr>
</tbody>
</table>
<p>Some things to keep in mind:</p>
<ul>
<li><p class="first">The stdout output of grompp is only shown when an error occurs. For
debugging, look at the log file or screen output and try running the
normal <tt class="xref py py-func docutils literal"><span class="pre">gromacs.grompp()</span></tt> command and analyze the output if the
debugging messages are not sufficient.</p>
</li>
<li><p class="first">Check that <tt class="docutils literal"><span class="pre">qtot</span></tt> is correct. Because the function is based on pattern
matching of the informative output of <strong class="program">grompp</strong> it can break when
the output format changes. This version recognizes lines like</p>
<div class="highlight-python"><div class="highlight"><pre><span class="s">&#39;  System has non-zero total charge: -4.000001e+00&#39;</span>
</pre></div>
</div>
<p>using the regular expression
<tt class="regexp docutils literal"><span class="pre">System</span> <span class="pre">has</span> <span class="pre">non-zero</span> <span class="pre">total</span> <span class="pre">charge:</span> <span class="pre">*(?P&lt;qtot&gt;[-+]?d*.d+([eE][-+]d+)?)</span></tt>.</p>
</li>
</ul>
</dd></dl>

<dl class="function">
<dt>
<tt class="descclassname">gromacs.cbook.</tt><tt class="descname">get_volume</tt><big>(</big><em>f</em><big>)</big></dt>
<dd><p>Return the volume in nm^3 of structure file <em>f</em>.</p>
<p>(Uses <tt class="xref py py-func docutils literal"><span class="pre">gromacs.editconf()</span></tt>; error handling is not good)</p>
</dd></dl>

<dl class="function">
<dt id="gromacs.cbook.parse_ndxlist">
<tt class="descclassname">gromacs.cbook.</tt><tt class="descname">parse_ndxlist</tt><big>(</big><em>output</em><big>)</big><a class="headerlink" href="#gromacs.cbook.parse_ndxlist" title="Permalink to this definition">¶</a></dt>
<dd><p>Parse output from make_ndx to build list of index groups:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">groups</span> <span class="o">=</span> <span class="n">parse_ndxlist</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
</pre></div>
</div>
<p>output should be the standard output from <tt class="docutils literal"><span class="pre">make_ndx</span></tt>, e.g.:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">rc</span><span class="p">,</span><span class="n">output</span><span class="p">,</span><span class="n">junk</span> <span class="o">=</span> <span class="n">gromacs</span><span class="o">.</span><span class="n">make_ndx</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="nb">input</span><span class="o">=</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="s">&#39;q&#39;</span><span class="p">),</span> <span class="n">stdout</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
<p>(or simply use</p>
<blockquote>
<div>rc,output,junk = cbook.make_ndx_captured(...)</div></blockquote>
<p>which presets input, stdout and stderr; of course input can be overriden.)</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns :</th><td class="field-body"><p class="first">The function returns a list of dicts (<tt class="docutils literal"><span class="pre">groups</span></tt>) with fields</p>
<dl class="last docutils">
<dt>name</dt>
<dd><p class="first last">name of the groups</p>
</dd>
<dt>nr</dt>
<dd><p class="first last">number of the group (starts at 0)</p>
</dd>
<dt>natoms</dt>
<dd><p class="first last">number of atoms in the group</p>
</dd>
</dl>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
<div class="section" id="working-with-topologies-and-mdp-files">
<h2>Working with topologies and mdp files<a class="headerlink" href="#working-with-topologies-and-mdp-files" title="Permalink to this headline">¶</a></h2>
<dl class="function">
<dt id="gromacs.cbook.create_portable_topology">
<tt class="descclassname">gromacs.cbook.</tt><tt class="descname">create_portable_topology</tt><big>(</big><em>topol</em>, <em>struct</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#gromacs.cbook.create_portable_topology" title="Permalink to this definition">¶</a></dt>
<dd><p>Create a processed topology.</p>
<p>The processed (or portable) topology file does not contain any
<tt class="docutils literal"><span class="pre">#include</span></tt> statements and hence can be easily copied around. It
also makes it possible to re-grompp without having any special itp
files available.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments :</th><td class="field-body"><dl class="first docutils">
<dt><em>topol</em></dt>
<dd><p class="first last">topology file</p>
</dd>
<dt><em>struct</em></dt>
<dd><p class="first last">coordinat (structure) file</p>
</dd>
</dl>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Keywords :</th><td class="field-body"><dl class="first docutils">
<dt><em>processed</em></dt>
<dd><p class="first last">name of the new topology file; if not set then it is named like
<em>topol</em> but with <tt class="docutils literal"><span class="pre">pp_</span></tt> prepended</p>
</dd>
<dt><em>includes</em></dt>
<dd><p class="first last">path or list of paths of directories in which itp files are
searched for</p>
</dd>
<dt><em>grompp_kwargs*</em></dt>
<dd><p class="first last">other options for <strong class="program">grompp</strong> such as <tt class="docutils literal"><span class="pre">maxwarn=2</span></tt> can
also be supplied</p>
</dd>
</dl>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Returns :</th><td class="field-body"><p class="first last">full path to the processed topology</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="gromacs.cbook.edit_mdp">
<tt class="descclassname">gromacs.cbook.</tt><tt class="descname">edit_mdp</tt><big>(</big><em>mdp</em>, <em>new_mdp=None</em>, <em>extend_parameters=None</em>, <em>**substitutions</em><big>)</big><a class="headerlink" href="#gromacs.cbook.edit_mdp" title="Permalink to this definition">¶</a></dt>
<dd><p>Change values in a Gromacs mdp file.</p>
<p>Parameters and values are supplied as substitutions, eg <tt class="docutils literal"><span class="pre">nsteps=1000</span></tt>.</p>
<p>By default the template mdp file is <strong>overwritten in place</strong>.</p>
<p>If a parameter does not exist in the template then it cannot be substituted
and the parameter/value pair is returned. The user has to check the
returned list in order to make sure that everything worked as expected. At
the moment it is not possible to automatically append the new values to the
mdp file because of ambiguities when having to replace dashes in parameter
names with underscores (see the notes below on dashes/underscores).</p>
<p>If a parameter is set to the value <tt class="docutils literal"><span class="pre">None</span></tt> then it will be ignored.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments :</th><td class="field-body"><dl class="first docutils">
<dt><em>mdp</em> <span class="classifier-delimiter">:</span> <span class="classifier">filename</span></dt>
<dd><p class="first last">filename of input (and output filename of <tt class="docutils literal"><span class="pre">new_mdp=None</span></tt>)</p>
</dd>
<dt><em>new_mdp</em> <span class="classifier-delimiter">:</span> <span class="classifier">filename</span></dt>
<dd><p class="first last">filename of alternative output mdp file [None]</p>
</dd>
<dt><em>extend_parameters</em> <span class="classifier-delimiter">:</span> <span class="classifier">string or list of strings</span></dt>
<dd><p class="first last">single parameter or list of parameters for which the new values
should be appended to the existing value in the mdp file. This
makes mostly sense for a single parameter, namely &#8216;include&#8217;, which
is set as the default. Set to <tt class="docutils literal"><span class="pre">[]</span></tt> to disable. [&#8216;include&#8217;]</p>
</dd>
<dt><em>substitutions</em></dt>
<dd><p class="first">parameter=value pairs, where parameter is defined by the Gromacs
mdp file; dashes in parameter names have to be replaced by
underscores. If a value is a list-like object then the items are
written as a sequence, joined with spaces, e.g.</p>
<div class="last highlight-python"><pre>ref_t=[310,310,310] ---&gt;  ref_t = 310 310 310</pre>
</div>
</dd>
</dl>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns :</th><td class="field-body"><p class="first last">Dict of parameters that have <em>not</em> been substituted.</p>
</td>
</tr>
</tbody>
</table>
<p><strong>Example</strong></p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">edit_mdp</span><span class="p">(</span><span class="s">&#39;md.mdp&#39;</span><span class="p">,</span> <span class="n">new_mdp</span><span class="o">=</span><span class="s">&#39;long_md.mdp&#39;</span><span class="p">,</span> <span class="n">nsteps</span><span class="o">=</span><span class="mi">100000</span><span class="p">,</span> <span class="n">nstxtcout</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">lincs_iter</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>Dashes in Gromacs mdp parameters have to be replaced by an underscore
when supplied as python keyword arguments (a limitation of python). For example
the MDP syntax is  <tt class="docutils literal"><span class="pre">lincs-iter</span> <span class="pre">=</span> <span class="pre">4</span></tt> but the corresponding  keyword would be
<tt class="docutils literal"><span class="pre">lincs_iter</span> <span class="pre">=</span> <span class="pre">4</span></tt>.</li>
<li>If the keyword is set as a dict key, eg <tt class="docutils literal"><span class="pre">mdp_params['lincs-iter']=4</span></tt> then one
does not have to substitute.</li>
<li>Parameters <em>aa_bb</em> and <em>aa-bb</em> are considered the same (although this should
not be a problem in practice because there are no mdp parameters that only
differ by a underscore).</li>
<li>This code is more compact in <tt class="docutils literal"><span class="pre">Perl</span></tt> as one can use <tt class="docutils literal"><span class="pre">s///</span></tt> operators:
<tt class="docutils literal"><span class="pre">s/^(\s*${key}\s*=\s*).*/$1${val}/</span></tt></li>
</ul>
</div>
<div class="admonition-see-also admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last">One can also load the mdp file with
<tt class="xref py py-class docutils literal"><span class="pre">gromacs.formats.MDP</span></tt>, edit the object (a dict), and save it again.</p>
</div>
</dd></dl>

<dl class="function">
<dt id="gromacs.cbook.add_mdp_includes">
<tt class="descclassname">gromacs.cbook.</tt><tt class="descname">add_mdp_includes</tt><big>(</big><em>topology=None</em>, <em>kwargs=None</em><big>)</big><a class="headerlink" href="#gromacs.cbook.add_mdp_includes" title="Permalink to this definition">¶</a></dt>
<dd><p>Set the mdp <em>include</em> key in the <em>kwargs</em> dict.</p>
<ol class="arabic simple">
<li>Add the directory containing <em>topology</em>.</li>
<li>Add all directories appearing under the key <em>includes</em></li>
<li>Generate a string of the form &#8220;-Idir1 -Idir2 ...&#8221; that
is stored under the key <em>include</em> (the corresponding
mdp parameter)</li>
</ol>
<p>By default, the directories <tt class="docutils literal"><span class="pre">.</span></tt> and <tt class="docutils literal"><span class="pre">..</span></tt> are also added to the
<em>include</em> string for the mdp; when fed into
<a class="reference internal" href="#gromacs.cbook.edit_mdp" title="gromacs.cbook.edit_mdp"><tt class="xref py py-func docutils literal"><span class="pre">gromacs.cbook.edit_mdp()</span></tt></a> it will result in a line such as</p>
<div class="highlight-python"><pre>include = -I. -I.. -I../topology_dir ....</pre>
</div>
<p>Note that the user can always override the behaviour by setting
the <em>include</em> keyword herself; in this case this function does
nothing.</p>
<p>If no <em>kwargs</em> were supplied then a dict is generated with the
single <em>include</em> entry.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments :</th><td class="field-body"><dl class="first docutils">
<dt><em>topology</em> <span class="classifier-delimiter">:</span> <span class="classifier">top filename</span></dt>
<dd><p class="first last">Topology file; the name of the enclosing directory is added
to the include path (if supplied) [<tt class="docutils literal"><span class="pre">None</span></tt>]</p>
</dd>
<dt><em>kwargs</em> <span class="classifier-delimiter">:</span> <span class="classifier">dict</span></dt>
<dd><p class="first last">Optional dictionary of mdp keywords; will be modified in place.
If it contains the <em>includes</em> keyword with either a single string
or a list of strings then these paths will be added to the
include statement.</p>
</dd>
</dl>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns :</th><td class="field-body"><p class="first last"><em>kwargs</em> with the <em>include</em> keyword added if it did not
exist previously; if the keyword already existed, nothing
happens.</p>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The <em>kwargs</em> dict is <strong>modified in place</strong>. This
function is a bit of a hack. It might be removed once
all setup functions become methods in a nice class.</p>
</div>
</dd></dl>

<dl class="function">
<dt>
<tt class="descclassname">gromacs.cbook.</tt><tt class="descname">grompp_qtot</tt><big>(</big><em>*args</em>, <em>**kwargs</em><big>)</big></dt>
<dd><p>Run <tt class="docutils literal"><span class="pre">gromacs.grompp</span></tt> and return the total charge of the  system.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments :</th><td class="field-body">The arguments are the ones one would pass to <tt class="xref py py-func docutils literal"><span class="pre">gromacs.grompp()</span></tt>.</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns :</th><td class="field-body">The total charge as reported</td>
</tr>
</tbody>
</table>
<p>Some things to keep in mind:</p>
<ul>
<li><p class="first">The stdout output of grompp is only shown when an error occurs. For
debugging, look at the log file or screen output and try running the
normal <tt class="xref py py-func docutils literal"><span class="pre">gromacs.grompp()</span></tt> command and analyze the output if the
debugging messages are not sufficient.</p>
</li>
<li><p class="first">Check that <tt class="docutils literal"><span class="pre">qtot</span></tt> is correct. Because the function is based on pattern
matching of the informative output of <strong class="program">grompp</strong> it can break when
the output format changes. This version recognizes lines like</p>
<div class="highlight-python"><div class="highlight"><pre><span class="s">&#39;  System has non-zero total charge: -4.000001e+00&#39;</span>
</pre></div>
</div>
<p>using the regular expression
<tt class="regexp docutils literal"><span class="pre">System</span> <span class="pre">has</span> <span class="pre">non-zero</span> <span class="pre">total</span> <span class="pre">charge:</span> <span class="pre">*(?P&lt;qtot&gt;[-+]?d*.d+([eE][-+]d+)?)</span></tt>.</p>
</li>
</ul>
</dd></dl>

</div>
<div class="section" id="working-with-index-files">
<h2>Working with index files<a class="headerlink" href="#working-with-index-files" title="Permalink to this headline">¶</a></h2>
<p>Manipulation of index files (<tt class="docutils literal"><span class="pre">ndx</span></tt>) can be cumbersome because the
<tt class="docutils literal"><span class="pre">make_ndx</span></tt> program is not very sophisticated (yet) compared to
full-fledged atom selection expression as available in <a class="reference external" href="http://www.charmm.org/html/documentation/c35b1/select.html">Charmm</a>, <a class="reference external" href="http://www.ks.uiuc.edu/Research/vmd/current/ug/node87.html">VMD</a>, or
<a class="reference external" href="http://mdanalysis.googlecode.com">MDAnalysis</a>. Some tools help in building and interpreting index files.</p>
<div class="admonition-see-also admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last">The <tt class="xref py py-class docutils literal"><span class="pre">gromacs.formats.NDX</span></tt> class can solve a number
of index problems in a cleaner way than the classes and
functions here.</p>
</div>
<dl class="class">
<dt id="gromacs.cbook.IndexBuilder">
<em class="property">class </em><tt class="descclassname">gromacs.cbook.</tt><tt class="descname">IndexBuilder</tt><big>(</big><em>struct=None</em>, <em>selections=None</em>, <em>names=None</em>, <em>name_all=None</em>, <em>ndx=None</em>, <em>out_ndx='selection.ndx'</em>, <em>offset=0</em><big>)</big><a class="headerlink" href="#gromacs.cbook.IndexBuilder" title="Permalink to this definition">¶</a></dt>
<dd><p>Build an index file with specified groups and the combined group.</p>
<p>This is <em>not</em> a full blown selection parser a la Charmm, VMD or
MDAnalysis but a very quick hack.</p>
<p><strong>Example</strong></p>
<blockquote>
<div><p>How to use the <a class="reference internal" href="#gromacs.cbook.IndexBuilder" title="gromacs.cbook.IndexBuilder"><tt class="xref py py-class docutils literal"><span class="pre">IndexBuilder</span></tt></a>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">G</span> <span class="o">=</span> <span class="n">gromacs</span><span class="o">.</span><span class="n">cbook</span><span class="o">.</span><span class="n">IndexBuilder</span><span class="p">(</span><span class="s">&#39;md_posres.pdb&#39;</span><span class="p">,</span>
              <span class="p">[</span><span class="s">&#39;S312:OG&#39;</span><span class="p">,</span><span class="s">&#39;T313:OG1&#39;</span><span class="p">,</span><span class="s">&#39;A38:O&#39;</span><span class="p">,</span><span class="s">&#39;A309:O&#39;</span><span class="p">,</span><span class="s">&#39;@a62549 &amp; r NA&#39;</span><span class="p">],</span>
              <span class="n">offset</span><span class="o">=-</span><span class="mi">9</span><span class="p">,</span> <span class="n">out_ndx</span><span class="o">=</span><span class="s">&#39;selection.ndx&#39;</span><span class="p">)</span>
<span class="n">groupname</span><span class="p">,</span> <span class="n">ndx</span> <span class="o">=</span> <span class="n">G</span><span class="o">.</span><span class="n">combine</span><span class="p">()</span>
<span class="k">del</span> <span class="n">G</span>
</pre></div>
</div>
<p>The residue numbers are given with their canonical resids from the
sequence or pdb. <em>offset=-9</em> says that one calculates Gromacs topology
resids by subtracting 9 from the canonical resid.</p>
<p>The combined selection is <tt class="docutils literal"><span class="pre">OR</span></tt> ed by default and written to
<em>selection.ndx</em>. One can also add all the groups in the initial <em>ndx</em>
file (or the <strong class="program">make_ndx</strong> default groups) to the output (see the
<em>defaultgroups</em> keyword for <a class="reference internal" href="#gromacs.cbook.IndexBuilder.combine" title="gromacs.cbook.IndexBuilder.combine"><tt class="xref py py-meth docutils literal"><span class="pre">IndexBuilder.combine()</span></tt></a>).</p>
<p>Generating an index file always requires calling
<a class="reference internal" href="#gromacs.cbook.IndexBuilder.combine" title="gromacs.cbook.IndexBuilder.combine"><tt class="xref py py-meth docutils literal"><span class="pre">combine()</span></tt></a> even if there is only a single group.</p>
<p>Deleting the class removes all temporary files associated with it (see
<tt class="xref py py-attr docutils literal"><span class="pre">IndexBuilder.indexfiles</span></tt>).</p>
</div></blockquote>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Raises :</th><td class="field-body"><p class="first">If an empty group is detected (which does not always work) then a
<a class="reference internal" href="../init.html#gromacs.BadParameterWarning" title="gromacs.BadParameterWarning"><tt class="xref py py-exc docutils literal"><span class="pre">gromacs.BadParameterWarning</span></tt></a> is issued.</p>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Bugs :</th><td class="field-body"><p class="first">If <tt class="docutils literal"><span class="pre">make_ndx</span></tt> crashes with an unexpected error then this is fairly hard to
diagnose. For instance, in certain cases it segmentation faults when a tpr
is provided as a <em>struct</em> file and the resulting error messages becomes</p>
<div class="highlight-python"><pre>GromacsError: [Errno -11] Gromacs tool failed
Command invocation: make_ndx -o /tmp/tmp_Na1__NK7cT3.ndx -f md_posres.tpr</pre>
</div>
<p class="last">In this case run the command invocation manually to see what the problem
could be.</p>
</td>
</tr>
</tbody>
</table>
<div class="admonition-see-also admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last">In some cases it might be more straightforward to use
<tt class="xref py py-class docutils literal"><span class="pre">gromacs.formats.NDX</span></tt>.</p>
</div>
<p>Build a index group from the selection arguments.</p>
<p>If selections and a structure file are supplied then the individual
selections are constructed with separate calls to
<tt class="xref py py-func docutils literal"><span class="pre">gromacs.make_ndx()</span></tt>. Use <a class="reference internal" href="#gromacs.cbook.IndexBuilder.combine" title="gromacs.cbook.IndexBuilder.combine"><tt class="xref py py-meth docutils literal"><span class="pre">IndexBuilder.combine()</span></tt></a> to combine
them into a joint selection or <tt class="xref py py-meth docutils literal"><span class="pre">IndexBuilder.write()</span></tt> to simply write
out the individual named selections (useful with <em>names</em>).</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments :</th><td class="field-body"><dl class="first last docutils">
<dt><em>struct</em> <span class="classifier-delimiter">:</span> <span class="classifier">filename</span></dt>
<dd><p class="first last">Structure file (tpr, pdb, ...)</p>
</dd>
<dt><em>selections</em> <span class="classifier-delimiter">:</span> <span class="classifier">list</span></dt>
<dd><p class="first">The list must contain strings or tuples, which must be be one of
the following constructs:</p>
<blockquote class="last">
<div><p>&#8220;&lt;1-letter aa code&gt;&lt;resid&gt;[:&lt;atom name]&#8221;</p>
<blockquote>
<div><p>Selects the CA of the residue or the specified atom
name.</p>
<p>example: <tt class="docutils literal"><span class="pre">&quot;S312:OA&quot;</span></tt> or <tt class="docutils literal"><span class="pre">&quot;A22&quot;</span></tt> (equivalent to <tt class="docutils literal"><span class="pre">&quot;A22:CA&quot;</span></tt>)</p>
</div></blockquote>
<p>(&#8220;&lt;1-letter aa code&gt;&lt;resid&gt;&#8221;, &#8220;&lt;1-letter aa code&gt;&lt;resid&gt;, [&#8220;&lt;atom name&gt;&#8221;])</p>
<blockquote>
<div><p>Selects a <em>range</em> of residues. If only two residue
identifiers are provided then all atoms are
selected. With an optional third atom identifier,
only this atom anme is selected for each residue
in the range. [EXPERIMENTAL]</p>
</div></blockquote>
<p>&#8220;&#64;&lt;make_ndx selection&gt;&#8221;</p>
<blockquote>
<div><p>The <tt class="docutils literal"><span class="pre">&#64;</span></tt> letter introduces a verbatim <tt class="docutils literal"><span class="pre">make_ndx</span></tt>
command. It will apply the given selection without any
further processing or checks.</p>
<p>example: <tt class="docutils literal"><span class="pre">&quot;&#64;a</span> <span class="pre">6234</span> <span class="pre">-</span> <span class="pre">6238&quot;</span></tt> or <tt class="docutils literal"><span class="pre">'&#64;&quot;SOL&quot;'</span></tt> (note the quoting)
or <tt class="docutils literal"><span class="pre">&quot;&#64;r</span> <span class="pre">SER</span> <span class="pre">&amp;</span> <span class="pre">r</span> <span class="pre">312</span> <span class="pre">&amp;</span> <span class="pre">t</span> <span class="pre">OA&quot;</span></tt>.</p>
</div></blockquote>
</div></blockquote>
</dd>
<dt><em>names</em> <span class="classifier-delimiter">:</span> <span class="classifier">list</span></dt>
<dd><p class="first last">Strings to name the selections; if not supplied or if individuals
are <tt class="docutils literal"><span class="pre">None</span></tt> then a default name is created. When simply using
<tt class="xref py py-meth docutils literal"><span class="pre">IndexBuilder.write()</span></tt> then these should be supplied.</p>
</dd>
<dt><em>name_all</em> <span class="classifier-delimiter">:</span> <span class="classifier">string</span></dt>
<dd><p class="first last">Name of the group that is generated by <a class="reference internal" href="#gromacs.cbook.IndexBuilder.combine" title="gromacs.cbook.IndexBuilder.combine"><tt class="xref py py-meth docutils literal"><span class="pre">IndexBuilder.combine()</span></tt></a>.</p>
</dd>
<dt><em>offset</em> <span class="classifier-delimiter">:</span> <span class="classifier">int, dict</span></dt>
<dd><p class="first last">This number is added to the resids in the first selection scheme; this
allows names to be the same as in a crystal structure. If offset is a
dict then it is used to directly look up the resids.</p>
</dd>
<dt><em>ndx</em> <span class="classifier-delimiter">:</span> <span class="classifier">filename or list of filenames</span></dt>
<dd><p class="first last">Optional input index file(s).</p>
</dd>
<dt><em>out_ndx</em> <span class="classifier-delimiter">:</span> <span class="classifier">filename</span></dt>
<dd><p class="first last">Output index file.</p>
</dd>
</dl>
</td>
</tr>
</tbody>
</table>
<dl class="method">
<dt id="gromacs.cbook.IndexBuilder.combine">
<tt class="descname">combine</tt><big>(</big><em>name_all=None</em>, <em>out_ndx=None</em>, <em>operation='|'</em>, <em>defaultgroups=False</em><big>)</big><a class="headerlink" href="#gromacs.cbook.IndexBuilder.combine" title="Permalink to this definition">¶</a></dt>
<dd><p>Combine individual groups into a single one and write output.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Keywords :</th><td class="field-body"><dl class="first docutils">
<dt>name_all <span class="classifier-delimiter">:</span> <span class="classifier">string</span></dt>
<dd><p class="first last">Name of the combined group, <tt class="docutils literal"><span class="pre">None</span></tt> generates a name.  [<tt class="docutils literal"><span class="pre">None</span></tt>]</p>
</dd>
<dt>out_ndx <span class="classifier-delimiter">:</span> <span class="classifier">filename</span></dt>
<dd><p class="first last">Name of the output file that will contain the individual groups
and the combined group. If <tt class="docutils literal"><span class="pre">None</span></tt> then default from the class
constructor is used. [<tt class="docutils literal"><span class="pre">None</span></tt>]</p>
</dd>
<dt>operation <span class="classifier-delimiter">:</span> <span class="classifier">character</span></dt>
<dd><p class="first last">Logical operation that is used to generate the combined group from
the individual groups: &#8220;|&#8221; (OR) or &#8220;&amp;&#8221; (AND); if set to <tt class="docutils literal"><span class="pre">False</span></tt>
then no combined group is created and only the individual groups
are written. [&#8220;|&#8221;]</p>
</dd>
<dt>defaultgroups <span class="classifier-delimiter">:</span> <span class="classifier">bool</span></dt>
<dd><p class="first last"><tt class="docutils literal"><span class="pre">True</span></tt>: append everything to the default groups produced by
<strong class="program">make_ndx</strong> (or rather, the groups provided in the ndx file on
initialization &#8212; if this was <tt class="docutils literal"><span class="pre">None</span></tt> then these are truly default groups);
<tt class="docutils literal"><span class="pre">False</span></tt>: only use the generated groups</p>
</dd>
</dl>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns :</th><td class="field-body"><p class="first last"><tt class="docutils literal"><span class="pre">(combinedgroup_name,</span> <span class="pre">output_ndx)</span></tt>, a tuple showing the
actual group name and the name of the file; useful when all names are autogenerated.</p>
</td>
</tr>
</tbody>
</table>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">The order of the atom numbers in the combined group is
<em>not</em> guaranteed to be the same as the selections on input because
<tt class="docutils literal"><span class="pre">make_ndx</span></tt> sorts them ascending. Thus you should be careful when
using these index files for calculations of angles and dihedrals.
Use <tt class="xref py py-class docutils literal"><span class="pre">gromacs.formats.NDX</span></tt> in these cases.</p>
</div>
<div class="admonition-see-also admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last"><tt class="xref py py-meth docutils literal"><span class="pre">IndexBuilder.write()</span></tt>.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="gromacs.cbook.IndexBuilder.gmx_resid">
<tt class="descname">gmx_resid</tt><big>(</big><em>resid</em><big>)</big><a class="headerlink" href="#gromacs.cbook.IndexBuilder.gmx_resid" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns resid in the Gromacs index by transforming with offset.</p>
</dd></dl>

</dd></dl>

<dl class="function">
<dt>
<tt class="descclassname">gromacs.cbook.</tt><tt class="descname">parse_ndxlist</tt><big>(</big><em>output</em><big>)</big></dt>
<dd><p>Parse output from make_ndx to build list of index groups:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">groups</span> <span class="o">=</span> <span class="n">parse_ndxlist</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
</pre></div>
</div>
<p>output should be the standard output from <tt class="docutils literal"><span class="pre">make_ndx</span></tt>, e.g.:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">rc</span><span class="p">,</span><span class="n">output</span><span class="p">,</span><span class="n">junk</span> <span class="o">=</span> <span class="n">gromacs</span><span class="o">.</span><span class="n">make_ndx</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="nb">input</span><span class="o">=</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="s">&#39;q&#39;</span><span class="p">),</span> <span class="n">stdout</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
<p>(or simply use</p>
<blockquote>
<div>rc,output,junk = cbook.make_ndx_captured(...)</div></blockquote>
<p>which presets input, stdout and stderr; of course input can be overriden.)</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns :</th><td class="field-body"><p class="first">The function returns a list of dicts (<tt class="docutils literal"><span class="pre">groups</span></tt>) with fields</p>
<dl class="last docutils">
<dt>name</dt>
<dd><p class="first last">name of the groups</p>
</dd>
<dt>nr</dt>
<dd><p class="first last">number of the group (starts at 0)</p>
</dd>
<dt>natoms</dt>
<dd><p class="first last">number of atoms in the group</p>
</dd>
</dl>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="gromacs.cbook.get_ndx_groups">
<tt class="descclassname">gromacs.cbook.</tt><tt class="descname">get_ndx_groups</tt><big>(</big><em>ndx</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#gromacs.cbook.get_ndx_groups" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a list of index groups in the index file <em>ndx</em>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments :</th><td class="field-body"><ul class="first simple">
<li><em>ndx</em>  is a Gromacs index file.</li>
<li>kwargs are passed to <a class="reference internal" href="#gromacs.cbook.make_ndx_captured" title="gromacs.cbook.make_ndx_captured"><tt class="xref py py-func docutils literal"><span class="pre">make_ndx_captured()</span></tt></a>.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns :</th><td class="field-body"><p class="first last">list of groups as supplied by <a class="reference internal" href="#gromacs.cbook.parse_ndxlist" title="gromacs.cbook.parse_ndxlist"><tt class="xref py py-func docutils literal"><span class="pre">parse_ndxlist()</span></tt></a></p>
</td>
</tr>
</tbody>
</table>
<p>Alternatively, load the index file with
<tt class="xref py py-class docutils literal"><span class="pre">gromacs.formats.NDX</span></tt> for full control.</p>
</dd></dl>

<dl class="function">
<dt id="gromacs.cbook.make_ndx_captured">
<tt class="descclassname">gromacs.cbook.</tt><tt class="descname">make_ndx_captured</tt><big>(</big><em>**kwargs</em><big>)</big><a class="headerlink" href="#gromacs.cbook.make_ndx_captured" title="Permalink to this definition">¶</a></dt>
<dd><p>make_ndx that captures all output</p>
<p>Standard <tt class="xref py py-func docutils literal"><span class="pre">make_ndx()</span></tt> command with the input and
output pre-set in such a way that it can be conveniently used for
<a class="reference internal" href="#gromacs.cbook.parse_ndxlist" title="gromacs.cbook.parse_ndxlist"><tt class="xref py py-func docutils literal"><span class="pre">parse_ndxlist()</span></tt></a>.</p>
<dl class="docutils">
<dt>Example::</dt>
<dd>ndx_groups = parse_ndxlist(make_ndx_captured(n=ndx)[0])</dd>
</dl>
<p>Note that the convenient <a class="reference internal" href="#gromacs.cbook.get_ndx_groups" title="gromacs.cbook.get_ndx_groups"><tt class="xref py py-func docutils literal"><span class="pre">get_ndx_groups()</span></tt></a> function does exactly
that and can probably used in most cases.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments :</th><td class="field-body">keywords are passed on to <tt class="xref py py-func docutils literal"><span class="pre">make_ndx()</span></tt></td>
</tr>
<tr class="field-even field"><th class="field-name">Returns :</th><td class="field-body">(<em>returncode</em>, <em>output</em>, <tt class="docutils literal"><span class="pre">None</span></tt>)</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
<div class="section" id="file-editing-functions">
<h2>File editing functions<a class="headerlink" href="#file-editing-functions" title="Permalink to this headline">¶</a></h2>
<p>It is often rather useful to be able to change parts of a template
file. For specialized cases the two following functions are useful:</p>
<dl class="function">
<dt>
<tt class="descclassname">gromacs.cbook.</tt><tt class="descname">edit_mdp</tt><big>(</big><em>mdp</em>, <em>new_mdp=None</em>, <em>extend_parameters=None</em>, <em>**substitutions</em><big>)</big></dt>
<dd><p>Change values in a Gromacs mdp file.</p>
<p>Parameters and values are supplied as substitutions, eg <tt class="docutils literal"><span class="pre">nsteps=1000</span></tt>.</p>
<p>By default the template mdp file is <strong>overwritten in place</strong>.</p>
<p>If a parameter does not exist in the template then it cannot be substituted
and the parameter/value pair is returned. The user has to check the
returned list in order to make sure that everything worked as expected. At
the moment it is not possible to automatically append the new values to the
mdp file because of ambiguities when having to replace dashes in parameter
names with underscores (see the notes below on dashes/underscores).</p>
<p>If a parameter is set to the value <tt class="docutils literal"><span class="pre">None</span></tt> then it will be ignored.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments :</th><td class="field-body"><dl class="first docutils">
<dt><em>mdp</em> <span class="classifier-delimiter">:</span> <span class="classifier">filename</span></dt>
<dd><p class="first last">filename of input (and output filename of <tt class="docutils literal"><span class="pre">new_mdp=None</span></tt>)</p>
</dd>
<dt><em>new_mdp</em> <span class="classifier-delimiter">:</span> <span class="classifier">filename</span></dt>
<dd><p class="first last">filename of alternative output mdp file [None]</p>
</dd>
<dt><em>extend_parameters</em> <span class="classifier-delimiter">:</span> <span class="classifier">string or list of strings</span></dt>
<dd><p class="first last">single parameter or list of parameters for which the new values
should be appended to the existing value in the mdp file. This
makes mostly sense for a single parameter, namely &#8216;include&#8217;, which
is set as the default. Set to <tt class="docutils literal"><span class="pre">[]</span></tt> to disable. [&#8216;include&#8217;]</p>
</dd>
<dt><em>substitutions</em></dt>
<dd><p class="first">parameter=value pairs, where parameter is defined by the Gromacs
mdp file; dashes in parameter names have to be replaced by
underscores. If a value is a list-like object then the items are
written as a sequence, joined with spaces, e.g.</p>
<div class="last highlight-python"><pre>ref_t=[310,310,310] ---&gt;  ref_t = 310 310 310</pre>
</div>
</dd>
</dl>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns :</th><td class="field-body"><p class="first last">Dict of parameters that have <em>not</em> been substituted.</p>
</td>
</tr>
</tbody>
</table>
<p><strong>Example</strong></p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">edit_mdp</span><span class="p">(</span><span class="s">&#39;md.mdp&#39;</span><span class="p">,</span> <span class="n">new_mdp</span><span class="o">=</span><span class="s">&#39;long_md.mdp&#39;</span><span class="p">,</span> <span class="n">nsteps</span><span class="o">=</span><span class="mi">100000</span><span class="p">,</span> <span class="n">nstxtcout</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">lincs_iter</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>Dashes in Gromacs mdp parameters have to be replaced by an underscore
when supplied as python keyword arguments (a limitation of python). For example
the MDP syntax is  <tt class="docutils literal"><span class="pre">lincs-iter</span> <span class="pre">=</span> <span class="pre">4</span></tt> but the corresponding  keyword would be
<tt class="docutils literal"><span class="pre">lincs_iter</span> <span class="pre">=</span> <span class="pre">4</span></tt>.</li>
<li>If the keyword is set as a dict key, eg <tt class="docutils literal"><span class="pre">mdp_params['lincs-iter']=4</span></tt> then one
does not have to substitute.</li>
<li>Parameters <em>aa_bb</em> and <em>aa-bb</em> are considered the same (although this should
not be a problem in practice because there are no mdp parameters that only
differ by a underscore).</li>
<li>This code is more compact in <tt class="docutils literal"><span class="pre">Perl</span></tt> as one can use <tt class="docutils literal"><span class="pre">s///</span></tt> operators:
<tt class="docutils literal"><span class="pre">s/^(\s*${key}\s*=\s*).*/$1${val}/</span></tt></li>
</ul>
</div>
<div class="admonition-see-also admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last">One can also load the mdp file with
<tt class="xref py py-class docutils literal"><span class="pre">gromacs.formats.MDP</span></tt>, edit the object (a dict), and save it again.</p>
</div>
</dd></dl>

<dl class="function">
<dt id="gromacs.cbook.edit_txt">
<tt class="descclassname">gromacs.cbook.</tt><tt class="descname">edit_txt</tt><big>(</big><em>filename</em>, <em>substitutions</em>, <em>newname=None</em><big>)</big><a class="headerlink" href="#gromacs.cbook.edit_txt" title="Permalink to this definition">¶</a></dt>
<dd><p>Primitive text file stream editor.</p>
<p>This function can be used to edit free-form text files such as the
topology file. By default it does an <strong>in-place edit</strong> of
<em>filename</em>. If <em>newname</em> is supplied then the edited
file is written to <em>newname</em>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments :</th><td class="field-body"><dl class="first last docutils">
<dt><em>filename</em></dt>
<dd><p class="first last">input text file</p>
</dd>
<dt><em>substitutions</em></dt>
<dd><p class="first last">substitution commands (see below for format)</p>
</dd>
<dt><em>newname</em></dt>
<dd><p class="first last">output filename; if <tt class="docutils literal"><span class="pre">None</span></tt> then <em>filename</em> is changed in
place [<tt class="docutils literal"><span class="pre">None</span></tt>]</p>
</dd>
</dl>
</td>
</tr>
</tbody>
</table>
<p><em>substitutions</em> is a list of triplets; the first two elements are regular
expression strings, the last is the substitution value. It mimics
<tt class="docutils literal"><span class="pre">sed</span></tt> search and replace. The rules for <em>substitutions</em>:</p>
<pre>
<strong id="grammar-token-substitutions">substitutions       </strong> ::=  &quot;[&quot; search_replace_tuple, ... &quot;]&quot;
<strong id="grammar-token-search_replace_tuple">search_replace_tuple</strong> ::=  &quot;(&quot; line_match_RE &quot;,&quot; search_RE &quot;,&quot; replacement &quot;)&quot;
<strong id="grammar-token-line_match_RE">line_match_RE       </strong> ::=  regular expression that selects the line (uses match)
<strong id="grammar-token-search_RE">search_RE           </strong> ::=  regular expression that is searched in the line
<strong id="grammar-token-replacement">replacement         </strong> ::=  replacement string for search_RE
</pre>
<p>Running <a class="reference internal" href="#gromacs.cbook.edit_txt" title="gromacs.cbook.edit_txt"><tt class="xref py py-func docutils literal"><span class="pre">edit_txt()</span></tt></a> does pretty much what a simple</p>
<div class="highlight-python"><pre>sed /line_match_RE/s/search_RE/replacement/</pre>
</div>
<p>with repeated substitution commands does.</p>
<p>Special replacement values:
- <tt class="docutils literal"><span class="pre">None</span></tt>: the rule is ignored
- <tt class="docutils literal"><span class="pre">False</span></tt>: the line is deleted (even if other rules match)</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>No sanity checks are performed and the substitutions must be supplied
exactly as shown.</li>
<li>All substitutions are applied to a line; thus the order of the substitution
commands may matter when one substitution generates a match for a subsequent rule.</li>
<li>If replacement is set to <tt class="docutils literal"><span class="pre">None</span></tt> then the whole expression is ignored and
whatever is in the template is used. To unset values you must provided an
empty string or similar.</li>
<li>Delete a matching line if replacement=``False``.</li>
</ul>
</div>
</dd></dl>

</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="setup.html" title="gromacs.setup – Setting up a Gromacs MD run"
             >next</a> |</li>
        <li class="right" >
          <a href="../building_blocks.html" title="Gromacs building blocks"
             >previous</a> |</li>
        <li><a href="../../index.html">GromacsWrapper 0.3.1 documentation</a> &raquo;</li>
          <li><a href="../../gromacs.html" >Gromacs package</a> &raquo;</li>
          <li><a href="../building_blocks.html" >Gromacs building blocks</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2009-2012, Oliver Beckstein, Jan Domański.
      Last updated on Dec 10, 2012.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>